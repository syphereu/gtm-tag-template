___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Sypher Cookie Consent CMP",
  "categories": [
    "TAG_MANAGEMENT",
    "PERSONALIZATION"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "Sypher",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Bring your website into compliance with data protection regulations by using Sypher Cookie Consent. Signup for free for Sypher: https://www.sypher.eu/pricing/cookie-consent-management",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "websiteUuid",
    "displayName": "Website UUID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "STRING_LENGTH",
        "args": [
          16,
          16
        ]
      }
    ],
    "help": "To obtain your website UUID, you need to have an account with Sypher. If you already have access to Sypher, you can find your website UUID in the \"Integration\" section. If you don\u0027t have an account yet, you can \u003ca href\u003d\"https://www.sypher.eu/pricing/cookie-consent-management\"\u003estart your free trial\u003c/a\u003e to get access."
  },
  {
    "type": "CHECKBOX",
    "name": "overWriteCMDefaults",
    "checkboxText": "Overwrite Google Consent Mode defaults",
    "simpleValueType": true
  },
  {
    "type": "GROUP",
    "name": "CMDefaults",
    "displayName": "",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SELECT",
        "name": "ad_storage",
        "displayName": "ad_storage",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "SELECT",
        "name": "analytics_storage",
        "displayName": "analytics_storage",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "SELECT",
        "name": "ad_user_data",
        "displayName": "ad_user_data",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "SELECT",
        "name": "ad_personalization",
        "displayName": "ad_personalization",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "SELECT",
        "name": "personalization_storage",
        "displayName": "personalization_storage",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "notSetText": "don\u0027t overwrite"
      },
      {
        "type": "SELECT",
        "name": "functionality_storage",
        "displayName": "functionality_storage",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "notSetText": "don\u0027t overwrite"
      },
      {
        "type": "SELECT",
        "name": "security_storage",
        "displayName": "security_storage",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "notSetText": "don\u0027t overwrite"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "overWriteCMDefaults",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "testMode",
    "checkboxText": "Use tag in test mode",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "testHost",
    "displayName": "Enter the test consent host URL",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "testMode",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Format: https://host.example.com/"
  },
  {
    "type": "TEXT",
    "name": "configHost",
    "displayName": "Enter the test configuration host URL",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "testMode",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const websiteuuid = data.websiteUuid;

const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const setDefaultConsentState = require('setDefaultConsentState');
const ls = require('localStorage');
const log = require('logToConsole');

let consentHost = data.testMode ? data.testHost : "https://cdn.sypher.eu/consent/";
let configHost = data.testMode ? data.configHost : "https://consent.sypher.eu/cnst/";
let consentJS = consentHost + 'script.min.js?uuid=' + data.websiteUuid;
let configJS = configHost + data.websiteUuid + '.js';

if (data.overWriteCMDefaults) {
    let consentState = {};
    consentState.ad_storage = data.ad_storage;
    consentState.analytics_storage = data.analytics_storage;
    consentState.ad_user_data = data.ad_user_data;
    consentState.ad_personalization = data.ad_personalization;

    if (typeof data.personalization_storage !== 'undefined') {
        consentState.personalization_storage = data.personalization_storage;
    }
    if (typeof data.functionality_storage !== 'undefined') {
        consentState.functionality_storage = data.functionality_storage;
    }
    if (typeof data.security_storage !== 'undefined') {
        consentState.security_storage = data.security_storage;
    }

    consentState.wait_for_update = 500;
    setDefaultConsentState(consentState);
    ls.setItem('sprGTMOverwriteDefaults', true);
} else {
    ls.removeItem('sprGTMOverwriteDefaults');
}

if (queryPermission('inject_script', configJS)) {
    injectScript(configJS, data.gtmOnSuccess, data.gtmOnFailure);
}

if (queryPermission('inject_script', consentJS)) {
    injectScript(consentJS, data.gtmOnSuccess, data.gtmOnFailure);
}


// Call data.gtmOnSuccess when the tag is finished.
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.sypher.eu/*"
              },
              {
                "type": 1,
                "string": "https://*.amazonaws.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_local_storage",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "sprGTMOverwriteDefaults"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 5/31/2024, 1:03:08 PM


